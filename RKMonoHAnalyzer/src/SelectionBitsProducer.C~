#define SelectionBitsProducer_cxx
#include "../interface/SelectionBitsProducer.h"
#include "../../NCUUtilities/interface/NCUDebugger.h"

std::vector<ResonanceMET<Resonance<Jet,Jet>,MET > > SelectionBitsProducer::SelectionBitsSaver(std::vector<ResonanceMET<Resonance<Jet,Jet>,MET > > objectCollection){
  std::vector<ResonanceMET<Resonance<Jet,Jet>,MET > > outputvec;
  outputvec.clear();
  if(objectCollection.size()>0){
    for(int i=0; i<(int)objectCollection.size();i++){
      if(NCUDebugger::debug_SelectionBitsProducer()) std::cout<<"   ========= DiJetMET entry number  ======= "<<i<<std::endl;
      if(NCUDebugger::debug_SelectionBitsProducer()) std::cout<<" mass = "<<objectCollection[i].jet1.ResonanceProp.InvMass<<std::endl;
      std::bitset<16> StatusOfCuts;
      StatusOfCuts = 0;
      // pt, eta of leading jet = 0
      // pt, eta of sub-leading jet = 0
      // btag of both jets 
      // MET > 70 
      // dphi(met,bb) > 2.5 
      // 100 < Mbb < 150
      // mT(bb,met) > 400 
      // mT(b1,MET) > 
      // mT (b2,MET) > 
      // deta (bb) < 1.0 
      // phi (bb) < 1.0
      
      
      if(objectCollection[i].jet1.ResonanceProp.InvMass > 50.) StatusOfCuts[0] = 1;
      if(fabs(objectCollection[i].jet1.ResonanceProp.DeltaEta) < 1.0) StatusOfCuts[1] = 1;
      if(fabs(objectCollection[i].jet1.ResonanceProp.DeltaPhi) < 1.0) StatusOfCuts[2] = 1;
      if(fabs(objectCollection[i].jet1.ResonanceProp.PtOverPt1Pt2) > 0.7) StatusOfCuts[3] = 1;
      
      objectCollection[i].cutsStatus = StatusOfCuts;
      std::cout<<" cut status selectionbits = "<<StatusOfCuts<<std::endl;
      //std::cout<<" value 1 = "<<(bitset<16>)MonoHiggsCuts::dphiJets <<std::endl;
      outputvec.push_back(objectCollection[i]);
    }//for(int i=0; i<(int)objectCollection.size();i++){
  }// if(objectCollection.size()>0){
  return outputvec;
}
