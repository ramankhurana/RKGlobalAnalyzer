void Macro_Optimization(){
 
  gStyle->SetOptStat(000000);
  gStyle->SetOptTitle(0);
  gStyle->SetPalette(1);
  gStyle->SetPaintTextFormat("4.3f ");


  TFile *fIn, *fInBack;
  fIn = new TFile("Merged_Signal/Merged_2000.root","READ"); //Signal
  fInBack = new TFile("Merged_QCD/Merged_2000-Inf.root","READ");  //Background

  TH2F *h_input, *h_inputBack;

  h_input = (TH2F*)fIn->Get("FJ_CSV1_CSV2");
  h_inputBack = (TH2F*)fInBack->Get("FJ_CSV1_CSV2");

  h_input->SetName("Signal");
  h_inputBack->SetName("Background");
 
 
  TFile *fOut = new TFile("Significance.root", "RECREATE");
  TH2F *h_Sig ;
  TH2F *h_Back;

  TH2F *hRatio;

  fOut->cd();
  h_Sig = EffCalc(h_input); 
  h_Sig->SetName("SignalEff");   

  h_Back = EffCalc(h_inputBack);
  h_Back->SetName("BackEff");

  hRatio = (TH2F*)h_Sig->Clone("hRatio");
  hRatio->Divide(h_Back);

  HistoDef(h_input);
  HistoDef(h_inputBack);
  HistoDef(h_Sig);
  HistoDef(h_Back);
  HistoDef(hRatio);
                                                                                      
  
  h_input->Write();
  h_inputBack->Write();
  h_Sig->Write();
  h_Back->Write();
  hRatio->Write();
  fOut->Close();
  

}

TH2F* EffCalc(TH2F* h){
  int nbins =  h->GetNbinsX();
  float xmin = h->GetXaxis()->GetXmin();
  float xmax = h->GetXaxis()->GetXmax();
  
  TH2F *hout = new TH2F("hout","hout", nbins, xmin, xmax, nbins, xmin, xmax);  
  for(int i=1; i < nbins+1; i++){
    for( int j=1; j< nbins+1; j++){
      hout->SetBinContent(i,j, ((h->Integral(i,nbins,j,nbins))/(h->Integral())));
    }
  }
  return hout;
}



void HistoDef(TH2F* h_out){
  TCanvas* c2 = new TCanvas("c2", "c2",286,100,460,490);
  c2->Range(-68.75,-7.5,856.25,42.5);
  c2->SetFillColor(0);
  c2->SetBorderMode(0);
  c2->SetBorderSize(2);
  c2->SetTickx(1);
  c2->SetTicky(1);
  c2->SetLeftMargin(0.13);
  c2->SetRightMargin(0.10);
  c2->SetTopMargin(0.07);//0.10
  c2->SetBottomMargin(0.10);
  c2->SetFrameFillStyle(0);
  c2->SetFrameBorderMode(0);
  c2->SetFrameFillStyle(0);
  c2->SetFrameBorderMode(0);
  c2->cd();
  c2->SetLogy(0);
  h_out->Draw("colztext");
  h_out->SetMarkerSize(1.2);
  h_out->GetXaxis()->SetTitle("CSV1");
  h_out->GetYaxis()->SetTitle("CSV2");
  h_out->GetYaxis()->SetTitleSize(0.045);
  h_out->GetXaxis()->SetTitleSize(0.045);
  h_out->GetXaxis()->SetLabelFont(22);
  h_out->GetYaxis()->SetLabelFont(22);
  h_out->GetXaxis()->SetTitleOffset(0.88);
  h_out->GetXaxis()->SetLabelFont(22);
  h_out->GetYaxis()->SetLabelFont(22);
  h_out->GetXaxis()->SetLabelSize(0.045);
  h_out->GetYaxis()->SetLabelSize(0.045);
  h_out->GetYaxis()->SetNdivisions(505);
  h_out->GetXaxis()->SetNdivisions(505);
  TString histname = h_out->GetName();
  c2->SaveAs("OptPlotsRaman/"+histname+".pdf");
  c2->SaveAs("OptPlotsRaman/"+histname+".png");
 }

